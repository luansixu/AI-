# 开发记录 - 03 系统实现逻辑

## 1. Game (核心引擎)
- **主循环:** 负责管理 clock 时间步长，依次调用 Player, Enemy, AIDirector, Vfx 的 update。
- **输入路由:** 监听键盘 (WASD, J, E)，将攻击指令下发给 Player，将交互检测留在 Game 层进行距离计算。
- **环境重置:** `initWorld` 方法执行精确的动态物体清理，重置 Player 状态、怪物数组和 AI 导演记忆。

## 2. AIDirector (逻辑大脑)
- **剧本推演:** 每 2 秒扫描一次 PlayerState。
- **需求链逻辑:**
  - **怜悯剧本:** Temp < 40 时生成火堆，Alert 设为 100 作为代价。
  - **贪婪剧本:** Greed > 25 且手持圣剑时生成 3 个追击怪。
  - **精英剧本:** 存活 > 60 秒生成蓝色小 Boss。
  - **惩罚剧本:** Alert > 80 时生成快速怪物。

## 3. EnemyManager (战斗系统)
- **追踪 AI:** 简单的向量减法 `player - enemy` 实现朝向玩家的匀速移动。
- **击退逻辑:** 被砍中时产生 `knockbackVel`，随时间通过 `multiplyScalar(0.85)` 衰减。
- **死亡掉落:** 具备 `onDropItem` 回调，击败蓝色怪时通知 Game 生成“冰霜之心”。

## 4. Player (状态机)
- **移动惩罚:** 根据手持 Item 的 `weight` 动态调整 `baseSpeed`。
- **体力循环:** 只有在 Sprint (Shift) 或 Attack 时消耗，正常行走不阻止回精。
- **视觉反馈:** `applyFrostHeart` 方法通过遍历子节点修改 Material 的颜色和发光度。

## 5. VfxManager (表现层)
- **生命周期:** 所有的 VFX 都是 `life` 驱动的，每一帧执行 `dt` 递减，life 归零时自动从 scene 移除。
- **斩击弧对齐:** 采用 Group 旋转 + SphereGeometry 起始角修正，确保特效 100% 同步玩家朝向。
